<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë¯¸í™” í’ˆëª© ì œì¶œ ì‹œìŠ¤í…œ (URL ê³µìœ )</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ë¯¸í™” í’ˆëª© ì œì¶œ ì‹œìŠ¤í…œ</h1>
            <p>ì œì¶œ í›„ ë§í¬ë¥¼ ë³µì‚¬í•´ì„œ ë‹¨í†¡ë°©ì— ê³µìœ í•˜ì„¸ìš”!</p>
        </header>

        <!-- ì œì¶œ í¼ -->
        <div id="formSection">
            <form id="itemForm">
                <div class="form-group">
                    <label for="name">ì‹ ì²­ì ì´ë¦„:</label>
                    <input type="text" id="name" name="name" required placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>

                <div class="form-group">
                    <label for="department">ë¶€ì„œ/íŒ€:</label>
                    <input type="text" id="department" name="department" required placeholder="ë¶€ì„œëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>

                <div class="items-section">
                    <h3>í•„ìš”í•œ í’ˆëª©</h3>
                    
                    <div class="item-row">
                        <label for="envelope">ë´‰íˆ¬:</label>
                        <input type="number" id="envelope" name="envelope" min="0" value="0" class="quantity-input">
                        <span class="unit">ê°œ</span>
                    </div>

                    <div class="item-row">
                        <label for="rag">ê±¸ë ˆ:</label>
                        <input type="number" id="rag" name="rag" min="0" value="0" class="quantity-input">
                        <span class="unit">ê°œ</span>
                    </div>

                    <div class="item-row">
                        <label for="bleach">ë½ìŠ¤:</label>
                        <input type="number" id="bleach" name="bleach" min="0" value="0" class="quantity-input">
                        <span class="unit">ë³‘</span>
                    </div>

                    <div class="item-row">
                        <label for="detergent">ì„¸ì œ:</label>
                        <input type="number" id="detergent" name="detergent" min="0" value="0" class="quantity-input">
                        <span class="unit">ë³‘</span>
                    </div>

                    <div class="item-row">
                        <label for="tissue">íœ´ì§€:</label>
                        <input type="number" id="tissue" name="tissue" min="0" value="0" class="quantity-input">
                        <span class="unit">ë¡¤</span>
                    </div>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn btn-primary">ì œì¶œí•˜ê¸°</button>
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">ë‹¤ì‹œ ì‘ì„±</button>
                </div>
            </form>
        </div>

        <!-- ì œì¶œ ì™„ë£Œ ì„¹ì…˜ -->
        <div id="successSection" class="success-section hidden">
            <div class="success-message">
                <h3>ì œì¶œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h3>
                <div id="submissionSummary"></div>
                
                <div style="margin: 20px 0; padding: 15px; background-color: #fff3cd; border-radius: 8px;">
                    <h4>ğŸ“± ë‹¨í†¡ë°©ì— ê³µìœ í•˜ê¸°</h4>
                    <p>ì•„ë˜ ë§í¬ë¥¼ ë³µì‚¬í•´ì„œ ë‹¨í†¡ë°©ì— ë³´ë‚´ì£¼ì„¸ìš”!</p>
                    <div style="background-color: white; padding: 10px; border-radius: 5px; margin: 10px 0; word-break: break-all; font-size: 14px;" id="shareUrl"></div>
                    <button type="button" class="btn btn-secondary" onclick="copyUrl()">ë§í¬ ë³µì‚¬</button>
                    <button type="button" class="btn btn-secondary" onclick="shareToKakao()">ì¹´í†¡ìœ¼ë¡œ ê³µìœ </button>
                </div>
            </div>
            
            <div class="button-group">
                <button type="button" class="btn btn-primary" onclick="showAllSubmissions()">ëª¨ë“  ì‹ ì²­ ë³´ê¸°</button>
                <button type="button" class="btn btn-secondary" onclick="newSubmission()">ìƒˆë¡œìš´ ì‹ ì²­</button>
            </div>
        </div>

        <!-- ì „ì²´ ì‹ ì²­ í˜„í™© -->
        <div id="allSubmissionsSection" class="hidden">
            <h2>ğŸ“‹ ëª¨ë“  ì‹ ì²­ í˜„í™©</h2>
            <p>ë‹¨í†¡ë°©ì— ê³µìœ ëœ ëª¨ë“  ì‹ ì²­ ë‚´ì—­ì…ë‹ˆë‹¤</p>
            
            <div id="allSubmissionsList"></div>
            
            <div class="summary-section">
                <h3>ğŸ§® ì „ì²´ ìš”ì•½</h3>
                <div id="totalSummary"></div>
            </div>
            
            <div class="button-group">
                <button type="button" class="btn btn-secondary" onclick="newSubmission()">ìƒˆ ì‹ ì²­í•˜ê¸°</button>
                <button type="button" class="btn btn-print" onclick="printSummary()">ìš”ì•½ ì¸ì‡„</button>
            </div>
        </div>

        <!-- ê°œë³„ ì‹ ì²­ ë³´ê¸° (URL íŒŒë¼ë¯¸í„°ë¡œ ì ‘ê·¼) -->
        <div id="viewSubmissionSection" class="hidden">
            <h2>ğŸ“ ì‹ ì²­ ë‚´ì—­</h2>
            <div id="submissionDetails"></div>
            
            <div class="button-group">
                <button type="button" class="btn btn-primary" onclick="editSubmission()">ìˆ˜ì •í•˜ê¸°</button>
                <button type="button" class="btn btn-secondary" onclick="showAllSubmissions()">ì „ì²´ ë³´ê¸°</button>
                <button type="button" class="btn btn-print" onclick="printThis()">ì¸ì‡„í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        const ITEM_INFO = {
            envelope: 'ë´‰íˆ¬',
            rag: 'ê±¸ë ˆ',
            bleach: 'ë½ìŠ¤',
            detergent: 'ì„¸ì œ',
            tissue: 'íœ´ì§€'
        };

        let currentSubmission = null;
        let allSubmissions = []; // URLì—ì„œ ìˆ˜ì§‘ëœ ëª¨ë“  ì‹ ì²­ë“¤

        // í˜ì´ì§€ ë¡œë“œì‹œ
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('itemForm').addEventListener('submit', handleSubmit);
            
            // URL íŒŒë¼ë¯¸í„° í™•ì¸
            const urlParams = new URLSearchParams(window.location.search);
            
            if (urlParams.has('view')) {
                // ê°œë³„ ì‹ ì²­ ë³´ê¸° ëª¨ë“œ
                showSubmissionFromUrl(urlParams);
            } else if (urlParams.has('all')) {
                // ì „ì²´ ë³´ê¸° ëª¨ë“œ
                showAllFromUrl();
            } else {
                // ê¸°ë³¸ í¼ ëª¨ë“œ
                showForm();
            }
        });

        // í¼ ì œì¶œ ì²˜ë¦¬
        function handleSubmit(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);
            
            // ê²€ì¦
            if (!data.name.trim() || !data.department.trim()) {
                alert('ì´ë¦„ê³¼ ë¶€ì„œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const hasItems = Object.keys(ITEM_INFO).some(key => parseInt(data[key]) > 0);
            if (!hasItems) {
                alert('ìµœì†Œ í•˜ë‚˜ì˜ í’ˆëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // í˜„ì¬ ì‹œê°„ ì¶”ê°€
            data.timestamp = new Date().toLocaleString('ko-KR');
            data.id = Date.now().toString();
            
            currentSubmission = data;
            showSuccess();
        }

        // ì„±ê³µ í™”ë©´ í‘œì‹œ
        function showSuccess() {
            hideAllSections();
            document.getElementById('successSection').classList.remove('hidden');
            
            // ì‹ ì²­ ìš”ì•½ í‘œì‹œ
            const items = [];
            Object.keys(ITEM_INFO).forEach(key => {
                if (parseInt(currentSubmission[key]) > 0) {
                    items.push(`${ITEM_INFO[key]} ${currentSubmission[key]}ê°œ`);
                }
            });
            
            document.getElementById('submissionSummary').innerHTML = `
                <p><strong>ì‹ ì²­ì:</strong> ${currentSubmission.name}</p>
                <p><strong>ë¶€ì„œ:</strong> ${currentSubmission.department}</p>
                <p><strong>ì‹ ì²­ í’ˆëª©:</strong> ${items.join(', ')}</p>
                <p><strong>ì‹ ì²­ ì‹œê°„:</strong> ${currentSubmission.timestamp}</p>
            `;
            
            // ê³µìœ  URL ìƒì„±
            const shareUrl = createShareUrl(currentSubmission);
            document.getElementById('shareUrl').textContent = shareUrl;
        }

        // ê³µìœ  URL ìƒì„±
        function createShareUrl(data) {
            const baseUrl = window.location.origin + window.location.pathname;
            const params = new URLSearchParams();
            
            params.set('view', '1');
            params.set('name', data.name);
            params.set('dept', data.department);
            params.set('time', data.timestamp);
            params.set('id', data.id);
            
            Object.keys(ITEM_INFO).forEach(key => {
                if (parseInt(data[key]) > 0) {
                    params.set(key, data[key]);
                }
            });
            
            return baseUrl + '?' + params.toString();
        }

        // URL ë³µì‚¬
        function copyUrl() {
            const url = document.getElementById('shareUrl').textContent;
            navigator.clipboard.writeText(url).then(() => {
                alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ë‹¨í†¡ë°©ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.');
            }).catch(() => {
                // ë³µì‚¬ ì‹¤íŒ¨ì‹œ ìˆ˜ë™ ì„ íƒ
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }

        // ì¹´ì¹´ì˜¤í†¡ ê³µìœ 
        function shareToKakao() {
            const url = document.getElementById('shareUrl').textContent;
            const message = `[ë¯¸í™” í’ˆëª© ì‹ ì²­]\n${currentSubmission.name}ë‹˜ì´ ì‹ ì²­í•˜ì…¨ìŠµë‹ˆë‹¤.\n\n${url}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'ë¯¸í™” í’ˆëª© ì‹ ì²­',
                    text: message,
                    url: url
                });
            } else {
                copyUrl();
            }
        }

        // URLì—ì„œ ì‹ ì²­ ì •ë³´ í‘œì‹œ
        function showSubmissionFromUrl(urlParams) {
            hideAllSections();
            document.getElementById('viewSubmissionSection').classList.remove('hidden');
            
            const submission = {
                name: urlParams.get('name'),
                department: urlParams.get('dept'),
                timestamp: urlParams.get('time'),
                id: urlParams.get('id')
            };
            
            const items = [];
            Object.keys(ITEM_INFO).forEach(key => {
                const value = urlParams.get(key);
                if (value && parseInt(value) > 0) {
                    submission[key] = value;
                    items.push(`${ITEM_INFO[key]} ${value}ê°œ`);
                }
            });
            
            document.getElementById('submissionDetails').innerHTML = `
                <div class="submission-item">
                    <h3>${submission.name}ë‹˜ì˜ ì‹ ì²­</h3>
                    <p><strong>ë¶€ì„œ:</strong> ${submission.department}</p>
                    <p><strong>ì‹ ì²­ ì‹œê°„:</strong> ${submission.timestamp}</p>
                    <p><strong>ì‹ ì²­ í’ˆëª©:</strong> ${items.join(', ')}</p>
                </div>
            `;
            
            currentSubmission = submission;
        }

        // ì „ì²´ ë³´ê¸° (URL ìˆ˜ì§‘)
        function showAllSubmissions() {
            // ì‹¤ì œë¡œëŠ” ë‹¨í†¡ë°©ì— ê³µìœ ëœ ë§í¬ë“¤ì„ ìˆ˜ë™ìœ¼ë¡œ ëª¨ì•„ì•¼ í•¨
            // ì—¬ê¸°ì„œëŠ” ë°ëª¨ìš©ìœ¼ë¡œ localStorage ì‚¬ìš©
            const saved = JSON.parse(localStorage.getItem('demoSubmissions') || '[]');
            
            hideAllSections();
            document.getElementById('allSubmissionsSection').classList.remove('hidden');
            
            if (saved.length === 0) {
                document.getElementById('allSubmissionsList').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <h3>ì•„ì§ ê³µìœ ëœ ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ë‹¨í†¡ë°©ì— ê³µìœ ëœ ë§í¬ë¥¼ í´ë¦­í•˜ë©´ ì—¬ê¸°ì„œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            const totals = {};
            
            saved.forEach(submission => {
                const items = [];
                Object.keys(ITEM_INFO).forEach(key => {
                    if (submission[key] && parseInt(submission[key]) > 0) {
                        items.push(`${ITEM_INFO[key]} ${submission[key]}ê°œ`);
                        totals[key] = (totals[key] || 0) + parseInt(submission[key]);
                    }
                });
                
                html += `
                    <div class="submission-item">
                        <h4>${submission.name} (${submission.department})</h4>
                        <p>${items.join(', ')}</p>
                        <small>${submission.timestamp}</small>
                    </div>
                `;
            });
            
            document.getElementById('allSubmissionsList').innerHTML = html;
            
            // ì „ì²´ ìš”ì•½
            let summaryHtml = '<div class="total-summary-grid">';
            Object.keys(ITEM_INFO).forEach(key => {
                if (totals[key] > 0) {
                    summaryHtml += `
                        <div class="total-item">
                            <div class="item-name">${ITEM_INFO[key]}</div>
                            <div class="item-total">${totals[key]}ê°œ</div>
                        </div>
                    `;
                }
            });
            summaryHtml += '</div>';
            
            document.getElementById('totalSummary').innerHTML = summaryHtml;
        }

        // ì„¹ì…˜ í‘œì‹œ í•¨ìˆ˜ë“¤
        function hideAllSections() {
            document.getElementById('formSection').style.display = 'none';
            document.getElementById('successSection').classList.add('hidden');
            document.getElementById('allSubmissionsSection').classList.add('hidden');
            document.getElementById('viewSubmissionSection').classList.add('hidden');
        }

        function showForm() {
            hideAllSections();
            document.getElementById('formSection').style.display = 'block';
        }

        function newSubmission() {
            // URL íŒŒë¼ë¯¸í„° ì œê±°í•˜ê³  í¼ìœ¼ë¡œ ì´ë™
            window.history.pushState({}, '', window.location.pathname);
            showForm();
            resetForm();
        }

        function resetForm() {
            document.getElementById('itemForm').reset();
        }

        function editSubmission() {
            // í˜„ì¬ ì‹ ì²­ ì •ë³´ë¡œ í¼ ì±„ìš°ê¸°
            if (currentSubmission) {
                document.getElementById('name').value = currentSubmission.name;
                document.getElementById('department').value = currentSubmission.department;
                
                Object.keys(ITEM_INFO).forEach(key => {
                    if (currentSubmission[key]) {
                        document.getElementById(key).value = currentSubmission[key];
                    }
                });
                
                showForm();
            }
        }

        // ë°ëª¨ìš©: í˜„ì¬ ì‹ ì²­ì„ ë¡œì»¬ì— ì €ì¥
        function saveForDemo() {
            if (currentSubmission) {
                const saved = JSON.parse(localStorage.getItem('demoSubmissions') || '[]');
                saved.push(currentSubmission);
                localStorage.setItem('demoSubmissions', JSON.stringify(saved));
            }
        }

        // í˜ì´ì§€ ì–¸ë¡œë“œì‹œ ë°ëª¨ ì €ì¥
        window.addEventListener('beforeunload', saveForDemo);
    </script>
</body>
</html>