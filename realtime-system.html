<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#4CAF50">
    <title>ë¯¸í™” í’ˆëª© ì œì¶œ ì‹œìŠ¤í…œ (ì‹¤ì‹œê°„)</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ë¯¸í™” í’ˆëª© ì œì¶œ ì‹œìŠ¤í…œ</h1>
            <p>ì‹¤ì‹œê°„ ê³µìœ  â€¢ íˆ¬ëª…í•œ ê´€ë¦¬</p>
            <div style="text-align: center; margin-top: 10px;">
                <span id="onlineStatus" style="padding: 5px 10px; border-radius: 15px; font-size: 14px; background: #4CAF50; color: white;">ğŸŸ¢ ì‹¤ì‹œê°„ ì—°ê²°ë¨</span>
            </div>
        </header>

        <!-- ë©”ë‰´ ë²„íŠ¼ë“¤ -->
        <div class="menu-buttons" style="display: flex; gap: 10px; justify-content: center; margin-bottom: 30px; flex-wrap: wrap;">
            <button type="button" class="btn btn-primary" onclick="showFormPage()">ìƒˆ ì‹ ì²­</button>
            <button type="button" class="btn btn-secondary" onclick="showListPage()">ì „ì²´ í˜„í™©</button>
            <button type="button" class="btn btn-secondary" onclick="showMyPage()">ë‚´ ì‹ ì²­</button>
            <button type="button" class="btn btn-secondary" onclick="showMonthlyPage()">ì›”ë³„ ì§‘ê³„</button>
        </div>

        <!-- ì‹ ì²­ í¼ í˜ì´ì§€ -->
        <div id="formPage">
            <form id="itemForm">
                <div class="form-group">
                    <label for="name">ì‹ ì²­ì ì´ë¦„:</label>
                    <input type="text" id="name" name="name" required placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="name">
                </div>

                <div class="form-group">
                    <label for="department">ë¶€ì„œ/íŒ€:</label>
                    <input type="text" id="department" name="department" required placeholder="ë¶€ì„œëª…ì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="organization">
                </div>

                <div class="form-group">
                    <label for="date">ì‹ ì²­ ë‚ ì§œ:</label>
                    <input type="date" id="date" name="date" required>
                </div>

                <div class="items-section">
                    <h3>í•„ìš”í•œ í’ˆëª©</h3>
                    
                    <div class="item-row">
                        <label for="envelope">ë´‰íˆ¬:</label>
                        <input type="number" id="envelope" name="envelope" min="0" value="0" class="quantity-input" inputmode="numeric" pattern="[0-9]*">
                        <span class="unit">ê°œ</span>
                    </div>

                    <div class="item-row">
                        <label for="rag">ê±¸ë ˆ:</label>
                        <input type="number" id="rag" name="rag" min="0" value="0" class="quantity-input" inputmode="numeric" pattern="[0-9]*">
                        <span class="unit">ê°œ</span>
                    </div>

                    <div class="item-row">
                        <label for="bleach">ë½ìŠ¤:</label>
                        <input type="number" id="bleach" name="bleach" min="0" value="0" class="quantity-input" inputmode="numeric" pattern="[0-9]*">
                        <span class="unit">ë³‘</span>
                    </div>

                    <div class="item-row">
                        <label for="detergent">ì„¸ì œ:</label>
                        <input type="number" id="detergent" name="detergent" min="0" value="0" class="quantity-input" inputmode="numeric" pattern="[0-9]*">
                        <span class="unit">ë³‘</span>
                    </div>

                    <div class="item-row">
                        <label for="tissue">íœ´ì§€:</label>
                        <input type="number" id="tissue" name="tissue" min="0" value="0" class="quantity-input" inputmode="numeric" pattern="[0-9]*">
                        <span class="unit">ë¡¤</span>
                    </div>

                    <div class="item-row">
                        <label for="trashbag">ì“°ë ˆê¸°ë´‰íˆ¬:</label>
                        <input type="number" id="trashbag" name="trashbag" min="0" value="0" class="quantity-input" inputmode="numeric" pattern="[0-9]*">
                        <span class="unit">ê°œ</span>
                    </div>

                    <div class="item-row">
                        <label for="gloves">ì¥ê°‘:</label>
                        <input type="number" id="gloves" name="gloves" min="0" value="0" class="quantity-input" inputmode="numeric" pattern="[0-9]*">
                        <span class="unit">ì¼¤ë ˆ</span>
                    </div>

                    <div class="item-row">
                        <label for="broom">ë¹—ìë£¨:</label>
                        <input type="number" id="broom" name="broom" min="0" value="0" class="quantity-input" inputmode="numeric" pattern="[0-9]*">
                        <span class="unit">ê°œ</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="memo">ë¹„ê³ :</label>
                    <textarea id="memo" name="memo" placeholder="ì¶”ê°€ ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì…ë ¥í•´ì£¼ì„¸ìš”" rows="3"></textarea>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn btn-primary">ì œì¶œí•˜ê¸°</button>
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">ë‹¤ì‹œ ì‘ì„±</button>
                </div>
            </form>
        </div>

        <!-- ì œì¶œ ì™„ë£Œ -->
        <div id="successSection" class="success-section hidden">
            <div class="success-message">
                <h3>âœ… ì œì¶œ ì™„ë£Œ!</h3>
                <p id="successInfo"></p>
                <p style="margin-top: 15px; padding: 15px; background: #e8f5e8; border-radius: 8px;">
                    ğŸš€ <strong>ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸!</strong><br>
                    ëª¨ë“  ì‚¬ìš©ìê°€ ì§€ê¸ˆ ë°”ë¡œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
            </div>
            <div class="button-group">
                <button type="button" class="btn btn-primary" onclick="showListPage()">ì „ì²´ í˜„í™© ë³´ê¸°</button>
                <button type="button" class="btn btn-secondary" onclick="showFormPage()">ìƒˆë¡œìš´ ì‹ ì²­</button>
            </div>
        </div>

        <!-- ì „ì²´ í˜„í™© í˜ì´ì§€ -->
        <div id="listPage" class="list-page hidden">
            <h2>ğŸ“Š ì „ì²´ ì‹ ì²­ í˜„í™©</h2>
            <div style="text-align: center; margin-bottom: 20px;">
                <span id="lastSync" style="color: #666; font-size: 14px;">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ë°©ê¸ˆ ì „</span>
                <button onclick="forceSync()" style="margin-left: 10px; padding: 5px 10px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">ğŸ”„</button>
            </div>
            
            <div class="list-controls">
                <div class="search-section">
                    <input type="text" id="searchInput" placeholder="ì´ë¦„ ë˜ëŠ” ë¶€ì„œë¡œ ê²€ìƒ‰..." class="search-input">
                    <button type="button" class="btn btn-secondary" onclick="filterList()">ê²€ìƒ‰</button>
                    <button type="button" class="btn btn-secondary" onclick="clearFilter()">ì „ì²´ë³´ê¸°</button>
                </div>
                <div class="view-controls">
                    <button type="button" class="btn btn-print" onclick="printList()">ëª©ë¡ ì¸ì‡„</button>
                </div>
            </div>

            <div class="list-content">
                <div id="listContainer"></div>
            </div>

            <div class="summary-section">
                <h3>ì´ë²ˆ ë‹¬ ì´ ìˆ˜ëŸ‰</h3>
                <div id="currentMonthSummary"></div>
            </div>
        </div>

        <!-- ë‚´ ì‹ ì²­ í˜ì´ì§€ -->
        <div id="myPage" class="list-page hidden">
            <h2>ğŸ“ ë‚´ ì‹ ì²­ ë‚´ì—­</h2>
            
            <div class="form-group">
                <label for="myName">ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰:</label>
                <input type="text" id="myName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" class="search-input">
                <button type="button" class="btn btn-secondary" onclick="searchMySubmissions()">ê²€ìƒ‰</button>
            </div>

            <div class="list-content">
                <div id="myListContainer"></div>
            </div>
        </div>

        <!-- ì›”ë³„ ì§‘ê³„ í˜ì´ì§€ -->
        <div id="monthlyPage" class="list-page hidden">
            <h2>ğŸ“… ì›”ë³„ ì§‘ê³„</h2>
            
            <div class="form-group">
                <label for="monthSelect">ì›” ì„ íƒ:</label>
                <select id="monthSelect" onchange="loadMonthlyData()" style="padding: 12px; font-size: 16px; border: 2px solid #ddd; border-radius: 8px;">
                    <option value="">ì›”ì„ ì„ íƒí•˜ì„¸ìš”</option>
                </select>
            </div>

            <div id="monthlyStats" class="hidden">
                <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 id="selectedMonth"></h3>
                    <p><strong>ì´ ì‹ ì²­ì:</strong> <span id="monthlyPeople">0</span>ëª…</p>
                    <p><strong>ì´ ì‹ ì²­ ê±´ìˆ˜:</strong> <span id="monthlyCount">0</span>ê±´</p>
                </div>

                <div class="summary-section">
                    <h3>ì›”ë³„ í’ˆëª© ì´ ìˆ˜ëŸ‰</h3>
                    <div id="monthlySummary"></div>
                </div>

                <div class="button-group">
                    <button type="button" class="btn btn-print" onclick="printMonthly()">ì›”ë³„ ì§‘ê³„ ì¸ì‡„</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ í’ˆëª© ì •ë³´
        const ITEM_INFO = {
            envelope: 'ë´‰íˆ¬',
            rag: 'ê±¸ë ˆ',
            bleach: 'ë½ìŠ¤',
            detergent: 'ì„¸ì œ',
            tissue: 'íœ´ì§€',
            trashbag: 'ì“°ë ˆê¸°ë´‰íˆ¬',
            gloves: 'ì¥ê°‘',
            broom: 'ë¹—ìë£¨'
        };

        const ITEM_UNITS = {
            envelope: 'ê°œ',
            rag: 'ê°œ',
            bleach: 'ë³‘',
            detergent: 'ë³‘',
            tissue: 'ë¡¤',
            trashbag: 'ê°œ',
            gloves: 'ì¼¤ë ˆ',
            broom: 'ê°œ'
        };

        const ITEM_KEYS = Object.keys(ITEM_INFO);

        // ì‹¤ì‹œê°„ ë™ê¸°í™”ë¥¼ ìœ„í•œ ë³€ìˆ˜ë“¤
        let lastSyncTime = Date.now();
        let syncInterval;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            
            document.getElementById('itemForm').addEventListener('submit', handleFormSubmit);
            
            // ì›” ì„ íƒ ì˜µì…˜ ìƒì„±
            populateMonthSelect();
            
            // ì‹¤ì‹œê°„ ë™ê¸°í™” ì‹œì‘
            startRealTimeSync();
            
            showFormPage();
        });

        // ì‹¤ì‹œê°„ ë™ê¸°í™” ì‹œì‘
        function startRealTimeSync() {
            // 10ì´ˆë§ˆë‹¤ ë°ì´í„° ë™ê¸°í™” ì²´í¬
            syncInterval = setInterval(() => {
                checkForUpdates();
            }, 10000);
            
            // í˜ì´ì§€ í¬ì»¤ìŠ¤ì‹œ ì¦‰ì‹œ ë™ê¸°í™”
            window.addEventListener('focus', () => {
                checkForUpdates();
            });
            
            // ë¸Œë¼ìš°ì € ê°„ í†µì‹  (ê°™ì€ ë„ë©”ì¸ì—ì„œë§Œ ì‘ë™)
            window.addEventListener('storage', (e) => {
                if (e.key === 'cleaningSubmissions') {
                    console.log('ë‹¤ë¥¸ íƒ­ì—ì„œ ë°ì´í„° ë³€ê²½ ê°ì§€!');
                    refreshCurrentPage();
                }
            });
        }

        // ì—…ë°ì´íŠ¸ ì²´í¬
        function checkForUpdates() {
            // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ì„œë²„ API í˜¸ì¶œ
            // ì—¬ê¸°ì„œëŠ” localStorageì˜ ë§ˆì§€ë§‰ ìˆ˜ì • ì‹œê°„ì„ ì²´í¬
            const submissions = JSON.parse(localStorage.getItem('cleaningSubmissions') || '[]');
            if (submissions.length > 0) {
                const latestSubmission = submissions[0];
                const latestTime = new Date(latestSubmission.submittedAt || latestSubmission.updatedAt).getTime();
                
                if (latestTime > lastSyncTime) {
                    console.log('ìƒˆë¡œìš´ ë°ì´í„° ë°œê²¬!');
                    lastSyncTime = latestTime;
                    refreshCurrentPage();
                    showNotification('ìƒˆë¡œìš´ ì‹ ì²­ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                }
            }
            
            // ë§ˆì§€ë§‰ ë™ê¸°í™” ì‹œê°„ ì—…ë°ì´íŠ¸
            updateSyncStatus();
        }

        // ê°•ì œ ë™ê¸°í™”
        function forceSync() {
            checkForUpdates();
            refreshCurrentPage();
            showNotification('ë°ì´í„°ë¥¼ ë™ê¸°í™”í–ˆìŠµë‹ˆë‹¤.');
        }

        // í˜„ì¬ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
        function refreshCurrentPage() {
            if (!document.getElementById('listPage').classList.contains('hidden')) {
                loadSubmissions();
            } else if (!document.getElementById('myPage').classList.contains('hidden')) {
                // ë‚´ ì‹ ì²­ í˜ì´ì§€ê°€ ì—´ë ¤ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ê²€ìƒ‰
                const name = document.getElementById('myName').value;
                if (name.trim()) {
                    searchMySubmissions();
                }
            } else if (!document.getElementById('monthlyPage').classList.contains('hidden')) {
                // ì›”ë³„ ì§‘ê³„ í˜ì´ì§€ê°€ ì—´ë ¤ìˆìœ¼ë©´ ë‹¤ì‹œ ë¡œë“œ
                loadMonthlyData();
            }
        }

        // ë™ê¸°í™” ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSyncStatus() {
            const now = new Date();
            document.getElementById('lastSync').textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${now.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'})}`;
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showNotification(message) {
            // ê°„ë‹¨í•œ í† ìŠ¤íŠ¸ ì•Œë¦¼
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4CAF50;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 1000;
                font-size: 14px;
                max-width: 300px;
                animation: slideIn 0.3s ease-out;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // 3ì´ˆ í›„ ì œê±°
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // CSS ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // í¼ ì œì¶œ ì²˜ë¦¬
        function handleFormSubmit(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);
            
            // í•„ìˆ˜ í•„ë“œ ê²€ì¦
            if (!data.name.trim()) {
                alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                document.getElementById('name').focus();
                return;
            }
            
            if (!data.department.trim()) {
                alert('ë¶€ì„œ/íŒ€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                document.getElementById('department').focus();
                return;
            }
            
            // ìµœì†Œ í•˜ë‚˜ì˜ í’ˆëª©ì´ ì„ íƒë˜ì—ˆëŠ”ì§€ í™•ì¸
            const hasItems = ITEM_KEYS.some(item => parseInt(data[item]) > 0);
            
            if (!hasItems) {
                alert('ìµœì†Œ í•˜ë‚˜ì˜ í’ˆëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì¦‰ì‹œ ì œì¶œ (í™•ì¸ ë‹¨ê³„ ìƒëµí•˜ê³  ë°”ë¡œ ì €ì¥)
            submitData(data);
        }

        // ë°ì´í„° ì¦‰ì‹œ ì œì¶œ
        function submitData(data) {
            // ë°ì´í„°ì— IDì™€ ì œì¶œ ì‹œê°„ ì¶”ê°€
            const submission = {
                ...data,
                id: Date.now().toString(),
                submittedAt: new Date().toISOString(),
                month: new Date(data.date).toISOString().slice(0, 7)
            };
            
            // localStorageì— ì €ì¥
            const submissions = JSON.parse(localStorage.getItem('cleaningSubmissions') || '[]');
            submissions.unshift(submission);
            localStorage.setItem('cleaningSubmissions', JSON.stringify(submissions));
            
            // ë§ˆì§€ë§‰ ë™ê¸°í™” ì‹œê°„ ì—…ë°ì´íŠ¸
            lastSyncTime = Date.now();
            
            // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
            showSuccess(data);
            
            // í¼ ì´ˆê¸°í™”
            resetForm();
            
            // ë‹¤ë¥¸ íƒ­/ë¸Œë¼ìš°ì €ì— ì•Œë¦¼ (storage ì´ë²¤íŠ¸ ë°œìƒ)
            localStorage.setItem('lastUpdate', Date.now().toString());
        }

        // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
        function showSuccess(data) {
            hideAllPages();
            document.getElementById('successSection').classList.remove('hidden');
            
            const items = [];
            ITEM_KEYS.forEach(key => {
                if (parseInt(data[key]) > 0) {
                    items.push(`${ITEM_INFO[key]} ${data[key]}${ITEM_UNITS[key]}`);
                }
            });
            
            document.getElementById('successInfo').innerHTML = `
                <strong>ì‹ ì²­ì:</strong> ${data.name}<br>
                <strong>ë¶€ì„œ:</strong> ${data.department}<br>
                <strong>ì‹ ì²­ í’ˆëª©:</strong> ${items.join(', ')}
            `;
        }

        // ì „ì²´ í˜„í™© í˜ì´ì§€
        function showListPage() {
            hideAllPages();
            document.getElementById('listPage').classList.remove('hidden');
            loadSubmissions();
        }

        // ì‹ ì²­ ëª©ë¡ ë¡œë“œ
        function loadSubmissions() {
            const submissions = JSON.parse(localStorage.getItem('cleaningSubmissions') || '[]');
            const container = document.getElementById('listContainer');
            
            if (submissions.length === 0) {
                container.innerHTML = '<p style="text-align: center; font-size: 18px; color: #666;">ì•„ì§ ì‹ ì²­ëœ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                updateCurrentMonthSummary([]);
                return;
            }
            
            let html = '';
            submissions.forEach((submission, index) => {
                html += createSubmissionHTML(submission, index);
            });
            
            container.innerHTML = html;
            updateCurrentMonthSummary(submissions);
            updateSyncStatus();
        }

        // ì‹ ì²­ í•­ëª© HTML ìƒì„±
        function createSubmissionHTML(submission, index) {
            const items = [];
            ITEM_KEYS.forEach(key => {
                if (parseInt(submission[key]) > 0) {
                    items.push(`${ITEM_INFO[key]} ${submission[key]}${ITEM_UNITS[key]}`);
                }
            });
            
            const submittedDate = new Date(submission.submittedAt);
            
            return `
                <div class="submission-item" style="position: relative;">
                    <div class="submission-header">
                        <div class="submission-info">
                            <span><strong>${submission.name}</strong> (${submission.department})</span>
                            <span>ì‹ ì²­ì¼: ${formatDate(submission.date)}</span>
                            <span>ì œì¶œ: ${submittedDate.toLocaleDateString('ko-KR')} ${submittedDate.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'})}</span>
                        </div>
                        <div class="submission-actions">
                            <button class="btn btn-secondary" onclick="deleteSubmission(${index})" style="background: #f44336; color: white;">ì‚­ì œ</button>
                        </div>
                    </div>
                    
                    <div class="submission-items">
                        ${items.map(item => `<div class="item-display"><div class="item-name">${item}</div></div>`).join('')}
                    </div>
                    
                    ${submission.memo ? `<div class="submission-memo"><p><strong>ë¹„ê³ :</strong> ${submission.memo}</p></div>` : ''}
                    
                    ${Date.now() - new Date(submission.submittedAt).getTime() < 60000 ? 
                        '<div style="position: absolute; top: 10px; right: 10px; background: #4CAF50; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px;">ğŸ†• ë°©ê¸ˆ ì „</div>' : ''}
                </div>
            `;
        }

        // ì´ë²ˆ ë‹¬ ì´ ìˆ˜ëŸ‰ ì—…ë°ì´íŠ¸
        function updateCurrentMonthSummary(submissions) {
            const currentMonth = new Date().toISOString().slice(0, 7);
            const currentMonthSubmissions = submissions.filter(s => s.month === currentMonth);
            
            const totals = {};
            currentMonthSubmissions.forEach(submission => {
                ITEM_KEYS.forEach(key => {
                    const quantity = parseInt(submission[key]) || 0;
                    if (quantity > 0) {
                        totals[key] = (totals[key] || 0) + quantity;
                    }
                });
            });
            
            let summaryHtml = '<div class="total-summary-grid">';
            ITEM_KEYS.forEach(key => {
                if (totals[key] > 0) {
                    summaryHtml += `
                        <div class="total-item">
                            <div class="item-name">${ITEM_INFO[key]}</div>
                            <div class="item-total">${totals[key]}${ITEM_UNITS[key]}</div>
                        </div>
                    `;
                }
            });
            summaryHtml += '</div>';
            
            document.getElementById('currentMonthSummary').innerHTML = summaryHtml || 
                '<p style="text-align: center; color: #666;">ì´ë²ˆ ë‹¬ ì‹ ì²­ëœ í’ˆëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        }

        // ë‚´ ì‹ ì²­ í˜ì´ì§€
        function showMyPage() {
            hideAllPages();
            document.getElementById('myPage').classList.remove('hidden');
        }

        // ë‚´ ì‹ ì²­ ê²€ìƒ‰
        function searchMySubmissions() {
            const name = document.getElementById('myName').value.trim();
            if (!name) {
                alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const submissions = JSON.parse(localStorage.getItem('cleaningSubmissions') || '[]');
            const mySubmissions = submissions.filter(s => s.name.includes(name));
            
            const container = document.getElementById('myListContainer');
            
            if (mySubmissions.length === 0) {
                container.innerHTML = `<p style="text-align: center; color: #666; padding: 40px;">"${name}"ë‹˜ì˜ ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
                return;
            }
            
            let html = `<h3>${name}ë‹˜ì˜ ì‹ ì²­ ë‚´ì—­ (ì´ ${mySubmissions.length}ê±´)</h3>`;
            mySubmissions.forEach((submission, index) => {
                const originalIndex = submissions.findIndex(s => s.id === submission.id);
                html += createSubmissionHTML(submission, originalIndex);
            });
            
            container.innerHTML = html;
        }

        // ì›”ë³„ ì§‘ê³„ í˜ì´ì§€
        function showMonthlyPage() {
            hideAllPages();
            document.getElementById('monthlyPage').classList.remove('hidden');
            populateMonthSelect();
        }

        // ì›” ì„ íƒ ì˜µì…˜ ìƒì„±
        function populateMonthSelect() {
            const submissions = JSON.parse(localStorage.getItem('cleaningSubmissions') || '[]');
            const months = [...new Set(submissions.map(s => s.month))].sort().reverse();
            
            const select = document.getElementById('monthSelect');
            select.innerHTML = '<option value="">ì›”ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            
            months.forEach(month => {
                const date = new Date(month + '-01');
                const monthText = date.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long' });
                select.innerHTML += `<option value="${month}">${monthText}</option>`;
            });
        }

        // ì›”ë³„ ë°ì´í„° ë¡œë“œ
        function loadMonthlyData() {
            const selectedMonth = document.getElementById('monthSelect').value;
            if (!selectedMonth) {
                document.getElementById('monthlyStats').classList.add('hidden');
                return;
            }
            
            const submissions = JSON.parse(localStorage.getItem('cleaningSubmissions') || '[]');
            const monthlySubmissions = submissions.filter(s => s.month === selectedMonth);
            
            // ì›”ë³„ í†µê³„
            const date = new Date(selectedMonth + '-01');
            const monthText = date.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long' });
            
            document.getElementById('selectedMonth').textContent = monthText + ' ì§‘ê³„';
            document.getElementById('monthlyPeople').textContent = new Set(monthlySubmissions.map(s => s.name)).size;
            document.getElementById('monthlyCount').textContent = monthlySubmissions.length;
            
            // ì›”ë³„ í’ˆëª© ì´ ìˆ˜ëŸ‰
            const totals = {};
            monthlySubmissions.forEach(submission => {
                ITEM_KEYS.forEach(key => {
                    const quantity = parseInt(submission[key]) || 0;
                    if (quantity > 0) {
                        totals[key] = (totals[key] || 0) + quantity;
                    }
                });
            });
            
            let summaryHtml = '<div class="total-summary-grid">';
            ITEM_KEYS.forEach(key => {
                if (totals[key] > 0) {
                    summaryHtml += `
                        <div class="total-item">
                            <div class="item-name">${ITEM_INFO[key]}</div>
                            <div class="item-total">${totals[key]}${ITEM_UNITS[key]}</div>
                        </div>
                    `;
                }
            });
            summaryHtml += '</div>';
            
            document.getElementById('monthlySummary').innerHTML = summaryHtml || 
                '<p style="text-align: center; color: #666;">í•´ë‹¹ ì›”ì— ì‹ ì²­ëœ í’ˆëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            
            document.getElementById('monthlyStats').classList.remove('hidden');
        }

        // ì‹ ì²­ ì‚­ì œ
        function deleteSubmission(index) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const submissions = JSON.parse(localStorage.getItem('cleaningSubmissions') || '[]');
                submissions.splice(index, 1);
                localStorage.setItem('cleaningSubmissions', JSON.stringify(submissions));
                
                // ë§ˆì§€ë§‰ ë™ê¸°í™” ì‹œê°„ ì—…ë°ì´íŠ¸
                lastSyncTime = Date.now();
                
                // í˜„ì¬ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                refreshCurrentPage();
                
                // ì›” ì„ íƒ ì˜µì…˜ ì—…ë°ì´íŠ¸
                populateMonthSelect();
                
                showNotification('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ê²€ìƒ‰ ë° í•„í„°
        function filterList() {
            const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
            if (!searchTerm) {
                alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const submissions = JSON.parse(localStorage.getItem('cleaningSubmissions') || '[]');
            const filtered = submissions.filter(s => 
                s.name.toLowerCase().includes(searchTerm) || 
                s.department.toLowerCase().includes(searchTerm)
            );
            
            const container = document.getElementById('listContainer');
            
            if (filtered.length === 0) {
                container.innerHTML = `<p style="text-align: center; color: #666; padding: 40px;">"${searchTerm}"ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
                return;
            }
            
            let html = '';
            filtered.forEach((submission, index) => {
                const originalIndex = submissions.findIndex(s => s.id === submission.id);
                html += createSubmissionHTML(submission, originalIndex);
            });
            
            container.innerHTML = html;
        }

        function clearFilter() {
            document.getElementById('searchInput').value = '';
            loadSubmissions();
        }

        // í˜ì´ì§€ ì „í™˜ í•¨ìˆ˜ë“¤
        function hideAllPages() {
            document.getElementById('formPage').style.display = 'none';
            document.getElementById('successSection').classList.add('hidden');
            document.getElementById('listPage').classList.add('hidden');
            document.getElementById('myPage').classList.add('hidden');
            document.getElementById('monthlyPage').classList.add('hidden');
        }

        function showFormPage() {
            hideAllPages();
            document.getElementById('formPage').style.display = 'block';
        }

        function resetForm() {
            document.getElementById('itemForm').reset();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // ì¸ì‡„ í•¨ìˆ˜ë“¤
        function printList() {
            window.print();
        }

        function printMonthly() {
            const selectedMonth = document.getElementById('monthSelect').value;
            if (!selectedMonth) {
                alert('ë¨¼ì € ì›”ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const monthText = document.getElementById('selectedMonth').textContent;
            const peopleCount = document.getElementById('monthlyPeople').textContent;
            const totalCount = document.getElementById('monthlyCount').textContent;
            const summaryHtml = document.getElementById('monthlySummary').innerHTML;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>${monthText}</title>
                    <style>
                        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; }
                        h1 { color: #4CAF50; }
                        .total-summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
                        .total-item { background: #f9f9f9; padding: 15px; text-align: center; border: 1px solid #ddd; }
                        .item-name { font-weight: bold; margin-bottom: 8px; }
                        .item-total { font-size: 24px; color: #4CAF50; font-weight: bold; }
                    </style>
                </head>
                <body>
                    <h1>${monthText}</h1>
                    <p><strong>ì´ ì‹ ì²­ì:</strong> ${peopleCount}ëª…</p>
                    <p><strong>ì´ ì‹ ì²­ ê±´ìˆ˜:</strong> ${totalCount}ê±´</p>
                    <p><strong>ì¶œë ¥ ì¼ì‹œ:</strong> ${new Date().toLocaleString('ko-KR')}</p>
                    <hr>
                    <h2>í’ˆëª©ë³„ ì´ ìˆ˜ëŸ‰</h2>
                    ${summaryHtml}
                </body>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // í˜ì´ì§€ ì–¸ë¡œë“œì‹œ ë™ê¸°í™” ì¤‘ì§€
        window.addEventListener('beforeunload', () => {
            if (syncInterval) {
                clearInterval(syncInterval);
            }
        });
    </script>
</body>
</html>